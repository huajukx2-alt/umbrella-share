<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Umbrella Share</title>
  <style>
    body { font-family: Arial, sans-serif; text-align:center; background:#f0f8ff; padding:20px; margin:0; }
    h1 { color:#333; margin-top:40px; }
    .btn { width:200px; padding:15px; margin:10px; border:none; border-radius:10px;
          font-size:18px; color:white; cursor:pointer; }
    .borrow { background:#28a745; }
    .return { background:#007bff; }
    .report { background:#dc3545; }
    .status { background:#ff9800; }
    .form, .result { display:none; margin-top:20px; }
    input, textarea, select { padding:10px; margin:10px; width:80%; max-width:250px; }
    .submit, .back { background:#333; color:white; padding:10px 20px; border:none; border-radius:5px; cursor:pointer; margin:5px; }
    table { margin:auto; border-collapse:collapse; width:95%; max-width:700px; }
    td, th { border:1px solid #999; padding:6px; font-size:14px; }
    /* ‡∏°‡∏∏‡∏°‡∏•‡πà‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏π‡πâ */
    .locker-select {
      position: fixed;
      bottom: 10px;
      right: 10px;
      background: white;
      border: 1px solid #ccc;
      border-radius: 8px;
      padding: 8px;
      font-size: 14px;
    }
    .status-table {
        margin-top: 20px;
    }
  </style>
</head>
<body>
  <h1>Umbrella Share</h1>

  <!-- ‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å -->
  <div id="home">
    <button class="btn borrow" onclick="showForm('‡∏¢‡∏∑‡∏°')">‡∏¢‡∏∑‡∏°</button>
    <button class="btn return" onclick="showForm('‡∏Ñ‡∏∑‡∏ô')">‡∏Ñ‡∏∑‡∏ô</button>
    <button class="btn report" onclick="showForm('‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°')">‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°</button>
    <button class="btn status" onclick="showForm('‡πÄ‡∏ä‡πá‡∏Ñ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞')">‡πÄ‡∏ä‡πá‡∏Ñ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</button>
  </div>

  <!-- ‡∏ü‡∏≠‡∏£‡πå‡∏° -->
  <div id="form" class="form">
    <h2 id="actionText"></h2>
    <div id="formContent"></div>
    <button class="back" onclick="goHome()">‡∏Å‡∏•‡∏±‡∏ö</button>
  </div>

  <!-- ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå -->
  <div id="result" class="result">
    <h2>‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå</h2>
    <div id="resultMsg"></div>
    <button class="back" onclick="goHome()">‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</button>
  </div>

  <!-- ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏π‡πâ -->
  <div class="locker-select">
    <label for="lockerSelect">üìç ‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà:</label>
    <select id="lockerSelect" onchange="changeLocker()">
      <option value="A">‡∏ï‡∏π‡πâ A - ‡∏ï‡∏∂‡∏Å‡∏ß‡∏¥‡∏®‡∏ß‡∏∞</option>
      <option value="B">‡∏ï‡∏π‡πâ B - ‡∏ï‡∏∂‡∏Å‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•</option>
      <option value="C">‡∏ï‡∏π‡πâ C - ‡∏´‡∏≠‡∏û‡∏±‡∏Å‡∏û‡∏∞‡∏¢‡∏≠‡∏° 4</option>
    </select>
  </div>

  <script>
    let currentAction = "";
    let currentLocker = "A"; // Default value

    // Global umbrella status
    let umbrellaStatus = JSON.parse(localStorage.getItem("umbrellaStatus")||"{}");
    if(Object.keys(umbrellaStatus).length===0){
      umbrellaStatus = {
        "0001": {status:"‡∏ß‡πà‡∏≤‡∏á", locker:"A"},
        "0002": {status:"‡∏ß‡πà‡∏≤‡∏á", locker:"A"},
        "0003": {status:"‡∏ß‡πà‡∏≤‡∏á", locker:"A"},
        "0004": {status:"‡∏ß‡πà‡∏≤‡∏á", locker:"A"},
        "0005": {status:"‡∏ß‡πà‡∏≤‡∏á", locker:"A"},
        "0006": {status:"‡∏ß‡πà‡∏≤‡∏á", locker:"B"},
        "0007": {status:"‡∏ß‡πà‡∏≤‡∏á", locker:"B"},
        "0008": {status:"‡∏ß‡πà‡∏≤‡∏á", locker:"B"},
        "0009": {status:"‡∏ß‡πà‡∏≤‡∏á", locker:"B"},
        "0010": {status:"‡∏ß‡πà‡∏≤‡∏á", locker:"B"},
        "0011": {status:"‡∏ß‡πà‡∏≤‡∏á", locker:"C"},
        "0012": {status:"‡∏ß‡πà‡∏≤‡∏á", locker:"C"},
        "0013": {status:"‡∏ß‡πà‡∏≤‡∏á", locker:"C"},
        "0014": {status:"‡∏ß‡πà‡∏≤‡∏á", locker:"C"},
        "0015": {status:"‡∏ß‡πà‡∏≤‡∏á", locker:"C"}
      };
      localStorage.setItem("umbrellaStatus", JSON.stringify(umbrellaStatus));
    }

    // New user data
    let users = {};
    const userData = [
        ["6820910001", "‡∏ô‡∏≤‡∏¢‡∏Å‡∏≤‡∏ç‡∏à‡∏ß‡∏±‡∏í‡∏ô‡πå ‡πÑ‡∏ä‡∏¢‡∏û‡∏á‡∏®‡πå", "0929626135"],
        ["6820910002", "‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏Å‡∏∏‡∏•‡∏ì‡∏±‡∏ê‡∏é‡∏≤ ‡πÑ‡∏ó‡∏£‡∏û‡∏±‡∏ô‡∏ò‡πå‡πÅ‡∏Å‡πâ‡∏ß", "0990568692"],
        ["6820910003", "‡∏ô‡∏≤‡∏¢‡πÄ‡∏Å‡∏µ‡∏¢‡∏£‡∏ï‡∏¥‡∏ô‡∏≥‡∏ä‡∏±‡∏¢ ‡∏ó‡∏≠‡∏á‡∏ô‡πâ‡∏≠‡∏¢", "0657394189"],
        ["6820910004", "‡∏ô‡∏≤‡∏¢‡∏à‡∏±‡∏Å‡∏£‡∏Å‡∏§‡∏©‡∏ì‡πå ‡∏ô‡∏¥‡∏•‡∏Ñ‡∏á", "0817203631"],
        ["6820910006", "‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏à‡∏±‡∏™‡∏°‡∏¥‡∏ô ‡∏ô‡∏¥‡∏•‡∏™‡∏°‡∏∏‡∏ó‡∏£‡πå", "0930865662"],
        ["6820910007", "‡∏ô‡∏≤‡∏¢‡∏ã‡∏≠‡∏•‡∏µ‡∏Æ‡∏µ‡∏ô ‡∏à‡∏¥‡∏ô‡∏î‡∏≤‡∏ß‡∏¥‡∏à‡∏¥‡∏ï‡∏£‡πå", "0658174394"],
        ["6820910009", "‡∏ô‡∏≤‡∏¢‡∏ì‡∏ß‡∏±‡∏í‡∏ô‡πå ‡πÇ‡∏û‡∏ò‡∏¥‡∏Ç‡∏≥", "0645924198"],
        ["6820910010", "‡∏ô‡∏≤‡∏¢‡∏ì‡∏±‡∏ä‡∏ä‡∏≤ ‡∏™‡∏±‡∏°‡∏§‡∏ó‡∏ò‡∏¥‡πå", "0807751321"],
        ["6820910011", "‡∏ô‡∏≤‡∏¢‡∏ì‡∏±‡∏è‡∏ê‡∏ä‡∏±‡∏¢ ‡∏™‡∏≤‡∏¢‡πÄ‡∏ó‡πâ‡∏≤‡πÄ‡∏≠‡∏µ‡πâ‡∏¢‡∏ô", "0649521413"],
        ["6820910012", "‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏ì‡∏±‡∏ê‡∏ô‡∏±‡∏ô‡∏ó‡πå ‡∏£‡∏±‡∏Å‡∏©‡∏®‡∏£‡∏µ", "0943180079"],
        ["6820910013", "‡∏ô‡∏≤‡∏¢‡∏ì‡∏±‡∏ê‡∏ß‡∏±‡∏í‡∏ô‡πå ‡πÄ‡∏û‡∏ä‡∏£‡∏≠‡∏≤‡∏ß‡∏∏‡∏ò", "0988861820"],
        ["6820910014", "‡∏ô‡∏≤‡∏¢‡∏ï‡πà‡∏ß‡∏ô‡∏Å‡∏π‡∏≠‡∏¥‡∏Ñ‡∏£‡∏±‡∏° ‡∏°‡∏≤‡∏°‡∏∞", "0621610441"],
        ["6820910015", "‡∏ô‡∏≤‡∏¢‡∏ò‡∏ô‡∏Å‡∏£ ‡∏ö‡∏£‡∏£‡∏™‡∏≤‡∏£", "0650836030"],
        ["6820910016", "‡∏ô‡∏≤‡∏¢‡∏ò‡∏ô‡∏Å‡∏§‡∏ï ‡πÅ‡∏Å‡πâ‡∏ß‡∏ó‡πà‡∏≤‡∏û‡∏¢‡∏≤", "0989726498"],
        ["6820910017", "‡∏ô‡∏≤‡∏¢‡∏ò‡∏£‡∏£‡∏® ‡∏ä‡∏π‡∏™‡∏∏‡∏ß‡∏£‡∏£‡∏ì‡πå", "0615758346"],
        ["6820910018", "‡∏ô‡∏≤‡∏¢‡∏ò‡∏¥‡∏£‡∏∞‡∏û‡∏á‡∏©‡πå ‡∏Ñ‡∏á‡∏®‡∏£‡∏µ", "0635024889"],
        ["6820910020", "‡∏ô‡∏≤‡∏¢‡∏ò‡∏µ‡∏£‡∏†‡∏±‡∏ó‡∏£ ‡πÑ‡∏Å‡∏£‡πÄ‡∏•‡∏¥‡∏®", "0635846903"],
        ["6820910021", "‡∏ô‡∏≤‡∏¢ ‡∏ô‡∏†‡∏±‡∏™ ‡∏®‡∏¥‡∏£‡∏¥‡∏£‡∏±‡∏ï‡∏ô‡∏≤‡∏ô‡∏ô‡∏ó‡πå", "0629823015"],
        ["6820910022", "‡∏ô‡∏≤‡∏¢ ‡∏ô‡∏†‡∏±‡∏™‡∏Å‡∏£ ‡∏à‡∏¥‡∏ô‡∏≤‡∏≠‡∏∏", "0955410907"],
        ["6820910023", "‡∏ô‡∏≤‡∏¢‡∏ô‡∏£‡∏≤‡∏ß‡∏¥‡∏ä‡∏ç‡πå ‡∏´‡∏ô‡∏±‡∏Å‡πÅ‡∏ô‡πà‡∏ô", "0966432347"],
        ["6820910024", "‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏ô‡∏±‡∏ä‡∏ç‡∏°‡∏µ ‡∏ó‡∏≠‡∏á‡∏î‡∏µ", "0807483778"],
        ["6820910025", "‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏ô‡∏∏‡∏£‡∏Æ‡∏±‡∏™‡∏°‡∏µ ‡∏™‡∏≤‡∏°‡∏∞", "0858435510"],
        ["6820910027", "‡∏ô‡∏≤‡∏¢‡∏õ‡∏£‡πÄ‡∏°‡∏©‡∏ê‡πå ‡∏Ñ‡∏á‡∏£‡∏±‡∏á‡∏©‡∏µ", "0925261556"],
        ["6820910028", "‡∏ô‡∏≤‡∏¢‡∏õ‡∏∏‡∏ì‡∏ì‡∏ß‡∏¥‡∏®‡∏ß‡πå ‡∏Ç‡∏≤‡∏ß‡∏õ‡∏≤‡∏ô", "0982900920"],
        ["6820910029", "‡∏ô‡∏≤‡∏¢ ‡∏û‡∏ô‡∏°‡∏Å‡∏£ ‡∏õ‡∏£‡∏∞‡πÄ‡∏û‡∏ä‡∏£", "0930072101"],
        ["6820910030", "‡∏ô‡∏≤‡∏¢‡∏£‡∏±‡∏ê‡∏†‡∏π‡∏°‡∏¥ ‡∏ô‡∏∏‡∏£‡∏≤‡∏ä", "0855744198"],
        ["6820910031", "‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏ß‡∏£‡∏£‡∏ì‡∏ô‡∏¥‡∏™‡∏≤ ‡πÄ‡∏Æ‡∏µ‡∏¢‡∏ô‡∏Æ‡∏∞", "0983460136"],
        ["6820910032", "‡∏ß‡∏£‡∏≤‡∏¢‡∏∏‡∏ó‡∏ò‡πå ‡∏´‡∏°‡∏ß‡∏Å‡∏û‡∏£‡∏≤‡∏¢", "0986983868"],
        ["6820910033", "‡∏ô‡∏≤‡∏¢‡∏ß‡∏µ‡∏£‡∏†‡∏≤‡∏û ‡∏´‡∏•‡∏á‡∏™‡∏°‡∏±‡∏ô", "0639504337"],
        ["6820910034", "‡∏ô‡∏≤‡∏¢‡∏ß‡∏µ‡∏£‡∏∞‡∏ß‡∏¥‡∏ä‡∏ç‡πå ‡∏ä‡∏≤‡∏¢‡πÄ‡∏Å‡∏•‡∏µ‡πâ‡∏¢‡∏á", "0982693901"],
        ["6820910035", "‡∏ô‡∏≤‡∏¢‡∏®‡∏¥‡∏ß‡πÄ‡∏ó‡∏û ‡πÅ‡∏ã‡πà‡∏•‡πà‡∏≠‡∏¢", "0985787932"],
        ["6820910036", "‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏©‡∏≤‡∏•‡∏¥‡∏ì‡∏µ ‡∏™‡∏≤‡πÅ‡∏°", "0648901159"],
        ["6820910037", "‡∏ô‡∏≤‡∏¢‡∏™‡∏ô‡∏ò‡∏¢‡∏≤ ‡∏Å‡∏∞‡∏´‡∏£‡∏¥‡∏°", "0639743355"],
        ["6820910038", "‡∏ô‡∏≤‡∏¢‡∏≠‡∏ò‡∏¥‡∏ß‡∏±‡∏í‡∏ô‡πå ‡∏£‡∏≠‡∏î‡∏£‡∏¥‡∏ô", "0807211859"],
        ["6820910039", "‡∏ô‡∏≤‡∏¢‡∏≠‡∏±‡∏ü‡∏î‡πä‡∏≠‡∏• ‡∏õ‡∏≤‡πÅ‡∏ô", "0838564015"],
        ["6820910040", "‡∏ô‡∏≤‡∏¢‡∏≠‡∏±‡∏™‡∏£‡∏¥‡∏ô ‡∏´‡∏°‡∏≤‡∏î‡∏ä‡∏≤‡∏¢", "0807583687"],
        ["6820910041", "‡∏ô‡∏≤‡∏¢‡πÄ‡∏≠‡∏Å‡∏û‡∏±‡∏ô‡∏ò‡πå ‡∏Å‡∏∏‡∏•‡∏ò‡∏ô", "0640681835"],
        ["6820910042", "‡∏ô‡∏≤‡∏¢‡∏Æ‡∏≤‡∏î‡∏¥‡∏© ‡πÄ‡∏´‡∏°‡∏™‡∏•‡∏≤‡∏´‡∏°‡∏≤‡∏î", "0651081106"],
        ["6820910043", "‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏Æ‡∏≤‡∏ô‡∏µ‡∏ã‡∏≤‡∏£‡πå ‡∏≠‡∏∏‡∏°‡∏≤", "0926639637"],
        ["6820910195", "‡∏ô‡∏≤‡∏¢‡∏ã‡∏∞‡∏≠‡∏π‡∏î‡∏µ ‡∏°‡∏∞‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå", "0925408356"],
        ["6820910196", "‡∏ô‡∏≤‡∏¢‡∏õ‡∏£‡∏°‡∏¥‡∏ô‡∏ó‡∏£‡πå ‡∏™‡∏∏‡∏Ç‡∏ô‡∏ß‡∏•", "0617634898"],
        ["6820910197", "‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏°‡∏¢‡∏∏‡∏£‡∏µ ‡∏ö‡∏¥‡∏•‡∏≠‡∏∞‡∏´‡∏•‡∏µ", "0983636160"],
        ["6820910198", "‡∏ô‡∏≤‡∏¢‡∏°‡∏π‡∏Æ‡∏≥‡∏´‡∏°‡∏±‡∏î‡∏¢‡∏π‡πÇ‡∏ã‡πä‡∏∞ ‡∏°‡∏∞‡∏´‡∏•‡∏µ", "0934105164"],
        ["6820910199", "‡∏ô‡∏≤‡∏¢‡∏™‡∏∏‡∏û‡∏±‡∏í‡∏ô‡πå ‡∏Ñ‡∏á‡∏™‡∏á", "0935802352"],
        ["6820910200", "‡∏ô‡∏≤‡∏¢‡∏≠‡∏ô‡∏∏‡∏ß‡∏±‡∏í‡∏ô‡πå ‡∏≠‡∏≤‡∏à‡∏´‡∏≤‡∏ç", "0959892420"],
        ["6820910213", "‡∏ô‡∏≤‡∏¢‡∏ó‡∏¥‡∏ô‡∏†‡∏±‡∏ó‡∏£ ‡∏ó‡∏≠‡∏á‡πÅ‡∏Å‡πâ‡∏ß‡πÄ‡∏Å‡∏¥‡∏î", "0925510447"],
        ["6820910214", "‡∏ô‡∏≤‡∏¢‡∏®‡∏£‡∏≤‡∏ß‡∏∏‡∏ò ‡∏™‡πâ‡∏≤‡∏´‡∏±‡∏ô", "0803757687"],
        ["6820930001", "‡∏ô‡∏≤‡∏¢‡∏à‡∏¥‡∏ï‡∏ï‡∏¥‡∏Å‡∏£ ‡∏à‡∏∏‡∏•‡∏Ñ‡∏á", "0936267040"],
        ["6820930002", "‡∏ô‡∏≤‡∏¢‡∏ä‡∏ç‡∏≤‡∏ô‡∏ô‡∏ó‡πå ‡∏≠‡∏¥‡∏ô‡∏ó‡∏§‡∏ó‡∏ò‡∏¥‡πå", "0614917226"],
        ["6820930003", "‡∏ô‡∏≤‡∏¢‡∏ó‡∏±‡∏®‡∏ô‡πå‡πÑ‡∏ó ‡πÄ‡∏à‡∏£‡∏¥‡∏ç‡∏™‡∏∏‡∏Ç‡∏°‡∏±‡πà‡∏ô", "0817634401"],
        ["6820930004", "‡∏ô‡∏≤‡∏¢‡∏ò‡∏µ‡∏£‡∏†‡∏±‡∏ó‡∏£‡πå ‡πÄ‡∏£‡∏∑‡∏≠‡∏á‡∏£‡∏±‡∏Å‡∏©‡πå", "0985806567"],
        ["6820930005", "‡∏ô‡∏≤‡∏¢‡∏£‡∏±‡∏ï‡∏ô‡∏ä‡∏±‡∏¢ ‡∏´‡∏ô‡∏π‡πÄ‡∏ó‡∏û", "0807532837"],
        ["6820930006", "‡∏ô‡∏≤‡∏¢‡∏®‡∏∏‡∏†‡∏Å‡∏£‡∏ì‡πå ‡∏ä‡∏±‡∏¢‡∏ß‡∏¥‡πÄ‡∏®‡∏©", "0934872559"],
        ["6820930007", "‡∏ô‡∏≤‡∏¢‡∏™‡∏£‡∏≤‡∏ß‡∏∏‡∏í‡∏ì‡πå ‡∏ô‡∏ß‡∏•‡∏ß‡∏î‡∏µ", "0807532837"],
        ["6820930008", "‡∏ô‡∏≤‡∏¢‡∏™‡∏£‡∏≤‡∏ß‡∏∏‡∏ò ‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå‡∏™‡∏∏‡∏Ç‡∏®‡∏£‡∏µ", "0653868296"]
    ];

    // Check if user data exists in localStorage, otherwise initialize it
    if (!localStorage.getItem("users")) {
        for (const user of userData) {
            users[user[0]] = {
                name: user[1],
                phone: user[2]
            };
        }
        localStorage.setItem("users", JSON.stringify(users));
    } else {
        users = JSON.parse(localStorage.getItem("users"));
    }

    function changeLocker(){
      currentLocker = document.getElementById("lockerSelect").value;
      console.log("Selected locker:", currentLocker);
    }

    function showForm(action) {
      currentAction = action;
      document.getElementById("home").style.display = "none";
      document.getElementById("form").style.display = "block";
      document.getElementById("result").style.display = "none";

      let html = "";
      let actionText = action;

      if(action==="‡∏¢‡∏∑‡∏°" || action==="‡∏Ñ‡∏∑‡∏ô"){
        html += `<input type="text" id="studentId" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß"><br>`;
        html += `<button class="submit" onclick="nextStep()">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</button>`;
        actionText += ` (‡∏ï‡∏π‡πâ ${currentLocker})`;
      } else if(action==="‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°"){
        html += `<input type="text" id="studentId" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß"><br>`;
        html += `<input type="text" id="umbrellaId" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏£‡πà‡∏° 4 ‡∏´‡∏•‡∏±‡∏Å"><br>`;
        html += `<textarea id="repairDetail" placeholder="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡∏ã‡πà‡∏≠‡∏°"></textarea><br>`;
        html += `<button class="submit" onclick="submitForm()">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</button>`;
      } else if(action==="‡πÄ‡∏ä‡πá‡∏Ñ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞"){
        // Build the complete HTML content for the status page
        let allStatusHtml = `<div class="status-table">`;
        allStatusHtml += `<h3>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏£‡πà‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h3>`;
        allStatusHtml += "<table><tr><th>‡∏£‡∏´‡∏±‡∏™‡∏£‡πà‡∏°</th><th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th><th>‡∏ó‡∏µ‡πà‡∏ï‡∏±‡πâ‡∏á‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</th></tr>";
        
        for(const id in umbrellaStatus){
          const umbrella = umbrellaStatus[id];
          allStatusHtml += `<tr><td>${id}</td><td>${umbrella.status}</td><td>${umbrella.locker}</td></tr>`;
        }
        allStatusHtml += "</table></div>";

        let personalStatusForm = `<p>‡∏´‡∏≤‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏î‡∏π‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì ‡πÉ‡∏´‡πâ‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á</p>`;
        personalStatusForm += `<input type="text" id="studentId" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß"><br>`;
        personalStatusForm += `<button class="submit" onclick="nextStep()">‡∏î‡∏π‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥</button>`;

        html = allStatusHtml + personalStatusForm;
      }
      document.getElementById("formContent").innerHTML = html;
      document.getElementById("actionText").innerText = actionText;
    }

    function nextStep(){
      const sid = document.getElementById("studentId").value.trim();
      // Only require student ID if not in the initial '‡πÄ‡∏ä‡πá‡∏Ñ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞' view
      if(!sid && currentAction !== '‡πÄ‡∏ä‡πá‡∏Ñ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞'){ alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß"); return; }
      
      let html = "";
      
      // Check if ID exists for '‡∏¢‡∏∑‡∏°', '‡∏Ñ‡∏∑‡∏ô', and '‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°' actions
      if (currentAction !== "‡πÄ‡∏ä‡πá‡∏Ñ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞" && !users[sid]) {
          html = `<p style="color:red;">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏´‡∏±‡∏™‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß‡∏ô‡∏µ‡πâ</p>`;
          document.getElementById("formContent").innerHTML = html;
          return;
      }
      
      const userInfo = users[sid];

      if(currentAction==="‡∏¢‡∏∑‡∏°"){
        let available = Object.entries(umbrellaStatus)
          .filter(([id,obj])=> obj.locker===currentLocker && obj.status==="‡∏ß‡πà‡∏≤‡∏á");
        if(available.length===0){
          html = `<p>‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡πà‡∏°‡∏ß‡πà‡∏≤‡∏á‡πÉ‡∏ô‡∏ï‡∏π‡πâ ${currentLocker}</p>`;
        } else {
          html += `<p>‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ: ${userInfo.name}<br>‡∏£‡∏´‡∏±‡∏™‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß: ${sid}</p>`;
          html += `<p>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡πà‡∏°‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏¢‡∏∑‡∏° (‡∏ï‡∏π‡πâ ${currentLocker})</p><select id="umbrellaId">`;
          available.forEach(([id])=> html += `<option value="${id}">${id}</option>`);
          html += `</select><br><button class="submit" onclick="submitForm('${sid}')">‡∏¢‡∏∑‡∏°</button>`;
        }
      } else if(currentAction==="‡∏Ñ‡∏∑‡∏ô"){
        let db = JSON.parse(localStorage.getItem("umbrellaDB")||"{}");
        // Filter for umbrellas that are currently borrowed by this student
        let list = db[sid]?.filter(r=>r.action==="‡∏¢‡∏∑‡∏°" && r.status==="‡∏ñ‡∏π‡∏Å‡∏¢‡∏∑‡∏°") || [];
        if(list.length===0){
          html = `<p>‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡πà‡∏°‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Ñ‡∏∑‡∏ô</p>`;
        } else {
          html += `<p>‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ: ${userInfo.name}<br>‡∏£‡∏´‡∏±‡∏™‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß: ${sid}</p>`;
          html += `<p>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡πà‡∏°‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏Ñ‡∏∑‡∏ô (‡∏ï‡∏π‡πâ ${currentLocker})</p><select id="umbrellaId">`;
          list.forEach(r=> html += `<option value="${r.umbrella}">${r.umbrella}</option>`);
          html += `</select><br><button class="submit" onclick="submitForm('${sid}')">‡∏Ñ‡∏∑‡∏ô</button>`;
        }
      } else if(currentAction==="‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°"){
        html += `<p>‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ: ${userInfo.name}<br>‡∏£‡∏´‡∏±‡∏™‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß: ${sid}</p>`;
        html += `<input type="text" id="umbrellaId" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏£‡πà‡∏° 4 ‡∏´‡∏•‡∏±‡∏Å"><br>`;
        html += `<textarea id="repairDetail" placeholder="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡∏ã‡πà‡∏≠‡∏°"></textarea><br>`;
        html += `<button class="submit" onclick="submitForm('${sid}')">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</button>`;
      } else if(currentAction==="‡πÄ‡∏ä‡πá‡∏Ñ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞"){
        let db = JSON.parse(localStorage.getItem("umbrellaDB")||"{}");
        let list = db[sid] || [];
        if(list.length===0){
          html = `<p>‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</p>`;
        } else {
          html = `<h3>‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á ${users[sid]?.name || sid}</h3>`;
          html += "<table><tr><th>‡∏£‡πà‡∏°</th><th>‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô</th><th>‡∏ï‡∏π‡πâ‡∏¢‡∏∑‡∏°</th><th>‡∏ï‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô</th><th>‡πÄ‡∏ß‡∏•‡∏≤</th><th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th></tr>";
          list.forEach(r=> html += `<tr><td>${r.umbrella}</td><td>${r.action}</td><td>${r.borrowLocker||'-'}</td><td>${r.returnLocker||'-'}</td><td>${r.time}</td><td>${r.status}</td></tr>`);
          html += "</table>";
        }
      }
      document.getElementById("formContent").innerHTML = html;
    }

    function submitForm(sid){
      const umbrellaId = document.getElementById("umbrellaId")?.value;
      const detail = document.getElementById("repairDetail")?.value || "";

      let db = JSON.parse(localStorage.getItem("umbrellaDB")||"{}");
      if(!db[sid]) db[sid] = [];

      if(currentAction==="‡∏¢‡∏∑‡∏°"){
        let record = {
          action: currentAction,
          umbrella: umbrellaId,
          time: new Date().toLocaleString(),
          borrowLocker: currentLocker,
          returnLocker: "-",
          status: "‡∏ñ‡∏π‡∏Å‡∏¢‡∏∑‡∏°"
        };
        db[sid].push(record);
        umbrellaStatus[umbrellaId].status="‡∏ñ‡∏π‡∏Å‡∏¢‡∏∑‡∏°";
      } else if(currentAction==="‡∏Ñ‡∏∑‡∏ô"){
        let recordToUpdate = db[sid].find(r => r.umbrella === umbrellaId && r.status === "‡∏ñ‡∏π‡∏Å‡∏¢‡∏∑‡∏°");
        if(recordToUpdate){
          recordToUpdate.status="‡∏Ñ‡∏∑‡∏ô‡πÅ‡∏•‡πâ‡∏ß";
          recordToUpdate.returnLocker=currentLocker;
        }
        umbrellaStatus[umbrellaId].status="‡∏ß‡πà‡∏≤‡∏á";
        umbrellaStatus[umbrellaId].locker=currentLocker;
      } else if(currentAction==="‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°"){
        let record = {
          action: currentAction,
          umbrella: umbrellaId,
          detail: detail,
          time: new Date().toLocaleString(),
          borrowLocker: "-",
          returnLocker: "-",
          status: "‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°"
        };
        db[sid].push(record);
        umbrellaStatus[umbrellaId] = {status:"‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°", locker:"‡∏≠‡∏¢‡∏π‡πà‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏ã‡πà‡∏≠‡∏°"};
      }
      
      localStorage.setItem("umbrellaDB", JSON.stringify(db));
      localStorage.setItem("umbrellaStatus", JSON.stringify(umbrellaStatus));

      const userInfo = users[sid];

      document.getElementById("form").style.display="none";
      document.getElementById("result").style.display="block";

      let resultRecord = db[sid].slice(-1)[0]; // Get the last record for display
      document.getElementById("resultMsg").innerHTML = `
        <h3>‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</h3>
        <p><b>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ:</b></p>
        <p>‡∏£‡∏´‡∏±‡∏™‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß: ${sid}<br>
        ‡∏ä‡∏∑‡πà‡∏≠: ${userInfo.name}<br>
        ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£: ${userInfo.phone}</p>
        <p><b>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£:</b></p>
        <p>‡∏£‡∏´‡∏±‡∏™‡∏£‡πà‡∏°: ${resultRecord.umbrella || '-'}<br>
        ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô: ${resultRecord.action}<br>
        ‡∏¢‡∏∑‡∏°‡∏à‡∏≤‡∏Å‡∏ï‡∏π‡πâ: ${resultRecord.borrowLocker || '-'}<br>
        ‡∏Ñ‡∏∑‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡∏π‡πâ: ${resultRecord.returnLocker || '-'}<br>
        ‡πÄ‡∏ß‡∏•‡∏≤: ${resultRecord.time}<br>
        ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ${resultRecord.status}</p>
      `;
    }

    function goHome(){
      document.getElementById("home").style.display="block";
      document.getElementById("form").style.display="none";
      document.getElementById("result").style.display="none";
    }
  </script>
</body>
</html>
